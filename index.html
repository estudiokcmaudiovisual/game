<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Runner – Malvadinha (pulo duplo, loja & demo)</title>
  <style>
    :root{
      /* paleta puxando a personagem (roxos e amarelos quentes) */
      --bg:#0f0a1f; --panel:#140f2b; --accent:#8b5cf6; --accent-2:#a78bfa;
      --text:#f3f4f6; --ok:#34d399; --amber:#f59e0b;
    }
    *{box-sizing:border-box}
    body{margin:0;min-height:100svh;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Helvetica,Arial; color:var(--text);
      background:radial-gradient(70rem 70rem at 70% -10%, #1d1740 20%, var(--bg) 60%); display:grid; place-items:center; padding:16px}
    .card{width:min(960px,100%); background:linear-gradient(180deg,#0d0a1f,#0a0918); border:1px solid #272248; border-radius:16px; box-shadow:0 10px 30px rgba(0,0,0,.35); overflow:hidden}
    header{display:flex;align-items:center;justify-content:space-between;padding:14px 16px;border-bottom:1px solid #272248;background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,0))}
    header h1{font-size:clamp(16px,2.5vw,20px);margin:0;font-weight:800;letter-spacing:.2px}
    header .controls{font-size:14px;opacity:.9}
    header kbd{background:#17132f;padding:2px 6px;border-radius:6px;border:1px solid #3b2e83;font-family:ui-monospace,Menlo,Consolas,monospace}

    .stage-wrap{position:relative;width:100%;aspect-ratio:16/9;background:linear-gradient(180deg,#0d0a1f 60%,#0a0a16 60%);display:grid;place-items:center}
    canvas{width:100%;height:100%;display:block}

    .hud{position:absolute;inset:0;pointer-events:none;padding:10px 12px;display:flex;justify-content:space-between;align-items:flex-start;font-weight:700;text-shadow:0 2px 8px rgba(0,0,0,.6);gap:8px}
    .left,.right{display:flex;gap:8px;flex-wrap:wrap}
    .chip{background:rgba(167,139,250,.12);border:1px solid rgba(167,139,250,.35);border-radius:999px;padding:6px 10px}
    .chip.ok{background:rgba(52,211,153,.12);border-color:rgba(52,211,153,.35)}
    .chip.amb{background:rgba(245,158,11,.12);border-color:rgba(245,158,11,.35)}

    .overlay{position:absolute;inset:0;display:grid;place-items:center}
    .panel{background:rgba(20,15,43,.88);backdrop-filter:blur(6px);border:1px solid #3b2e83;border-radius:14px;padding:18px 20px;text-align:center;max-width:90%}
    .title{font-size:clamp(18px,4vw,24px);margin:0 0 6px}
    .subtitle{font-size:clamp(14px,3vw,16px);margin:0 10px 10px;opacity:.95}
    .btn{display:inline-block;margin-top:10px;padding:10px 16px;border-radius:999px;background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#0e0a1f;font-weight:900;letter-spacing:.3px;border:none;cursor:pointer;box-shadow:0 8px 20px rgba(167,139,250,.25)}
    .btn:active{transform:translateY(1px)}

    .shop{display:grid;gap:8px;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));margin-top:10px}
    .item{border:1px solid #3b2e83;border-radius:12px;padding:12px;background:rgba(255,255,255,.02);text-align:left}
    .item h3{margin:0 0 6px;font-size:16px}
    .item p{margin:0;font-size:13px;opacity:.9}
    .item .price{font-weight:800;color:var(--ok);margin-top:6px}

    .mobile-tip{position:absolute;bottom:8px;left:0;right:0;text-align:center;font-size:12px;opacity:.7}
  </style>
</head>
<body>
  <div class="card" id="app">
    <header>
      <h1>Runner – Malvadinha</h1>
      <div class="controls">
        <span class="chip">Pular: <kbd>Espaço</kbd> / <kbd>↑</kbd> / toque</span>
        <span class="chip">Reiniciar: <kbd>R</kbd></span>
        <span class="chip">Loja: <kbd>L</kbd></span>
      </div>
    </header>

    <div class="stage-wrap" id="wrap">
      <canvas id="game" width="960" height="540" aria-label="Jogo runner"></canvas>
      <div class="hud" aria-live="polite">
        <div class="left">
          <span class="chip" id="score">Pontos: 0</span>
          <span class="chip ok" id="reais">Reais: 0</span>
          <span class="chip amb" id="lives">Vidas: 1</span>
        </div>
        <div class="right">
          <span class="chip" id="speed">Velocidade: 1.0x</span>
          <span class="chip" id="mode">Modo: DEMO</span>
        </div>
      </div>
      <div class="overlay" id="overlay">
        <div class="panel" id="panel">
          <p class="title" id="ovTitle">Pronto para correr?</p>
          <p class="subtitle" id="ovText">
            Ganhe <b>1 real</b> a cada <b>500 pontos</b>. Junte <b>25 reais</b> em uma única corrida para trocar por <b>vidas</b> ou <b>itens</b> na <b>Loja</b>.
            <br><br><i>Observação:</i> o jogo real só começa ao clicar em <b>Iniciar o jogo</b>. Sem clicar, fica em <b>modo demonstrativo</b> (sem acumular reais).
          </p>
          <button class="btn" id="startBtn" autofocus>Iniciar o jogo</button>
          <div class="mobile-tip">Toque na tela para pular</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ===== Guard-rails de debug =====
    function showOverlayError(msg){
      const overlay=document.getElementById('overlay'); overlay.style.display='grid';
      document.getElementById('ovTitle').textContent='Erro no jogo';
      document.getElementById('ovText').innerHTML=msg;
      document.getElementById('startBtn').textContent='Tentar novamente';
    }
    window.addEventListener('error',e=>showOverlayError(e.message||'Erro desconhecido'));
    window.addEventListener('unhandledrejection',e=>showOverlayError((e.reason&&e.reason.message)||'Falha de promessa não tratada'));
  </script>

  <script>
  (()=>{
    const canvas=document.getElementById('game');
    const ctx=canvas.getContext('2d');
    const overlay=document.getElementById('overlay');
    const startBtn=document.getElementById('startBtn');
    const scoreEl=document.getElementById('score');
    const reaisEl=document.getElementById('reais');
    const speedEl=document.getElementById('speed');
    const livesEl=document.getElementById('lives');
    const wrap=document.getElementById('wrap');
    const panel=document.getElementById('panel');
    const ovTitle=document.getElementById('ovTitle');
    const ovText=document.getElementById('ovText');

    // ========= Carregar frames da Malvadinha =========
    // Coloque estes arquivos PNG na MESMA PASTA do HTML.
    const FRAME_PATHS = [
      'MALVADINHA_PERFIL.png',    // corrida 1 (lado)
      'Malvadinha_4.png',         // corrida 2
      'Malvadinha_5.png',         // corrida 3
      'Malvadinha_6.png',         // corrida 4
      'Malvadinha_7.png',         // corrida 5
      'Malvadinha_3.png'          // corrida 6
    ];
    const JUMP_FRAME = 'MALVADINHA_45GRAUS.png';
    const HIT_FRAME  = 'Malvainha_8.png'; // (nome do arquivo recebido: Malvainha_8.png)

    function loadImage(src){ return new Promise((res,rej)=>{ const i=new Image(); i.src=src; i.onload=()=>res(i); i.onerror=rej; }); }
    let runFrames=[], jumpImg=null, hitImg=null;

    // HiDPI responsivo
    function resizeCanvasToDisplaySize(){
      const dpr=Math.max(1, Math.min(2, window.devicePixelRatio||1));
      const {clientWidth:cw, clientHeight:ch}=canvas; if(cw===0||ch===0) return;
      if(canvas.width!==cw*dpr||canvas.height!==ch*dpr){ canvas.width=cw*dpr; canvas.height=ch*dpr; }
      ctx.setTransform(dpr,0,0,dpr,0,0);
    }
    new ResizeObserver(resizeCanvasToDisplaySize).observe(wrap); resizeCanvasToDisplaySize();

    // ===== Estado =====
    let running=false, gameOver=false, demo=true;
    let tPrev=0, score=0, speed=1.0, spawnTimer=0;
    let reais=0, nextRealAt=500; // 1 real a cada 500 pts
    let lives=1; let redeemedCount=0;
    let jumpsUsed=0; const MAX_JUMPS=2; let hitCooldown=0;

    const GROUND_Y = ()=> canvas.height/(window.devicePixelRatio||1)*0.8;

    const player={ x:80, y:0, w:40, h:56, vy:0, onGround:true, frame:0, frameTimer:0, frameDur:1/12 };

    const obstacles=[];

    function spawnObstacle(){
      const typeRand=Math.random();
      const baseH=22+Math.random()*42; const w=18+Math.random()*16; const groundY=GROUND_Y();
      const xStart=canvas.width/(window.devicePixelRatio||1)+24;
      if(typeRand<Math.min(0.22+speed*0.02,0.5)){
        const h=18+Math.random()*20; const y=Math.max(groundY-(player.h+36+Math.random()*18),40);
        obstacles.push({x:xStart,y,w,h,kind:'fly'});
      }else if(typeRand<Math.min(0.48+speed*0.04,0.82)){
        const h1=baseH, h2=18+Math.random()*26; const gapPx=52+Math.random()*28;
        obstacles.push({x:xStart, y:groundY-h1, w, h:h1, kind:'box'});
        obstacles.push({x:xStart+gapPx, y:groundY-h2, w, h:h2, kind:'box'});
      }else{
        const y=groundY-baseH; const kind=Math.random()>0.8?'tall':'box';
        obstacles.push({x:xStart, y, w, h:baseH, kind});
      }
    }

    function openShop(){
      if(demo) return;
      overlay.style.display='grid';
      ovTitle.textContent='Loja';
      ovText.innerHTML=`Você tem <b>${reais} ${reais===1?'real':'reais'}</b>. Cada item custa <b>25 reais</b>.`;
      panel.querySelectorAll('.shop, .btn.shop-close').forEach(n=>n.remove());
      const shop=document.createElement('div'); shop.className='shop';
      const items=[
        {id:'vidas', title:'+2 vidas', desc:'Sobreviva por mais tempo nesta corrida.', action:()=>{ if(reais>=25){ reais-=25; lives+=2; redeemedCount++; closeShop(); } }},
        {id:'garrafa', title:'Garrafa 600ml', desc:'Cosmético HUD.', action:()=>{ if(reais>=25){ reais-=25; inventory.garrafa=true; redeemedCount++; closeShop(); } }},
        {id:'latinhas', title:'2 latinhas', desc:'Cosmético HUD.', action:()=>{ if(reais>=25){ reais-=25; inventory.latinhas+=2; redeemedCount++; closeShop(); } }},
        {id:'docinhos', title:'4 docinhos', desc:'Cosmético HUD.', action:()=>{ if(reais>=25){ reais-=25; inventory.docinhos+=4; redeemedCount++; closeShop(); } }}
      ];
      for(const it of items){
        const div=document.createElement('div'); div.className='item';
        div.innerHTML=`<h3>${it.title}</h3><p>${it.desc}</p><div class="price">25 reais</div>`; div.style.cursor='pointer';
        div.addEventListener('click',()=>{ it.action(); updateHUD(); }); shop.appendChild(div);
      }
      panel.appendChild(shop);
      const close=document.createElement('button'); close.className='btn shop-close'; close.textContent='Fechar (voltar ao jogo)';
      close.addEventListener('click',()=>closeShop()); panel.appendChild(close);
    }
    function closeShop(){ overlay.style.display='none'; if(!gameOver){ running=true; requestAnimationFrame(loop); } }

    let inventory={garrafa:false, latinhas:0, docinhos:0};

    function reset(){
      running=false; gameOver=false; demo=true; tPrev=0;
      score=0; speed=1.0; spawnTimer=0; reais=0; nextRealAt=500; lives=1; redeemedCount=0; jumpsUsed=0; hitCooldown=0;
      inventory={garrafa:false, latinhas:0, docinhos:0};
      player.y=GROUND_Y()-player.h; player.vy=0; player.onGround=true; player.frame=0; player.frameTimer=0;
      obstacles.length=0;
      overlay.style.display='grid'; ovTitle.textContent='Pronto para correr?';
      ovText.innerHTML='Ganhe <b>1 real</b> a cada <b>500 pontos</b>. Junte <b>25 reais</b> em uma única corrida para trocar por <b>vidas</b> ou <b>itens</b> na <b>Loja</b>.<br><br><i>Observação:</i> o jogo real só começa ao clicar em <b>Iniciar o jogo</b>. Sem clicar, fica em <b>modo demonstrativo</b> (sem acumular reais).';
      startBtn.textContent='Iniciar o jogo'; updateHUD(); draw();
    }

    function jump(){
      if(demo) return;
      if(!running||gameOver) return;
      if(jumpsUsed<MAX_JUMPS){ player.vy=-11.6; player.onGround=false; jumpsUsed++; }
    }
    function start(){ if(running) return; demo=false; score=0; reais=0; nextRealAt=500; redeemedCount=0; lives=1; jumpsUsed=0; hitCooldown=0; obstacles.length=0; overlay.style.display='none'; running=true; requestAnimationFrame(loop); }
    function endGame(){ running=false; gameOver=true; overlay.style.display='grid'; ovTitle.textContent='Fim de jogo'; ovText.innerHTML=`Você marcou <b>${Math.floor(score)}</b> pontos, juntou <b>${reais} ${reais===1?'real':'reais'}</b> e fez <b>${redeemedCount}</b> troca(s).`; startBtn.textContent='Jogar novamente'; }

    function updateHUD(){ scoreEl.textContent=`Pontos: ${Math.floor(score)}`; reaisEl.textContent=`Reais: ${reais}`; speedEl.textContent=`Velocidade: ${speed.toFixed(1)}x`; livesEl.textContent=`Vidas: ${lives}`; const modeEl=document.getElementById('mode'); if(modeEl) modeEl.textContent=`Modo: ${demo?'DEMO':'JOGO'}`; }

    window.addEventListener('keydown',e=>{ if(e.code==='Space'||e.code==='ArrowUp'){ e.preventDefault(); jump(); } else if(e.key.toLowerCase()==='r'){ reset(); } else if(e.key.toLowerCase()==='l'){ if(!gameOver && !demo){ running=false; openShop(); } } });
    canvas.addEventListener('pointerdown', jump);
    startBtn.addEventListener('click',()=>{ if(gameOver) reset(); else start(); });

    function rectsOverlap(a,b){ return a.x<b.x+b.w && a.x+a.w>b.x && a.y<b.y+b.h && a.y+a.h>b.y; }

    function loop(tNow){
      if(!running) return; if(!tPrev) tPrev=tNow; const dt=Math.min(1/30, (tNow-tPrev)/1000); tPrev=tNow;
      speed+=0.025*dt; const moveSpeed=220*speed;
      const timeAir=(2*11.6)/30; const minGapTime=Math.max(0.6, timeAir*0.95);

      player.vy+=30*dt; player.y+=player.vy; const ground=GROUND_Y()-player.h; if(player.y>=ground){ player.y=ground; player.vy=0; if(!player.onGround){ player.onGround=true; jumpsUsed=0; } } else { player.onGround=false; }

      // animação de corrida
      if(player.onGround){ player.frameTimer+=dt; while(player.frameTimer>=player.frameDur){ player.frame=(player.frame+1)%runFrames.length; player.frameTimer-=player.frameDur; } }

      spawnTimer+=dt; const baseTarget=Math.max(0.6, 1.6 - speed*0.22); const target=Math.max(baseTarget, minGapTime); if(spawnTimer>target){ spawnObstacle(); spawnTimer=0; }
      for(let i=1;i<obstacles.length;i++){ const prev=obstacles[i-1], cur=obstacles[i]; const gap=(cur.x-(prev.x+prev.w)); if(gap<moveSpeed*minGapTime*0.6){ cur.x=prev.x+prev.w+moveSpeed*minGapTime*0.6; } }
      for(let i=obstacles.length-1;i>=0;i--){ const o=obstacles[i]; o.x-=moveSpeed*dt; if(o.x+o.w<-10) obstacles.splice(i,1); }

      if(hitCooldown>0) hitCooldown=Math.max(0, hitCooldown-dt);

      const scoreRate=12*dt*(1+0.4*(speed-1)); score+=scoreRate;
      if(!demo){ while(score>=nextRealAt){ reais+=1; nextRealAt+=500; } if(reais>=25 && overlay.style.display==='none'){ running=false; openShop(); } }

      // colisão justa
      let collidedIdx=-1; for(let i=0;i<obstacles.length;i++){ const o=obstacles[i]; if(rectsOverlap({x:player.x,y:player.y,w:player.w,h:player.h},o)){ collidedIdx=i; break; } }
      if(collidedIdx>=0){ if(demo){ obstacles.length=0; score=0; nextRealAt=500; speed=1.0; jumpsUsed=0; player.y=ground; player.vy=0; player.onGround=true; } else if(hitCooldown<=0){ obstacles.splice(collidedIdx,1); lives-=1; hitCooldown=0.7; if(lives<=0){ endGame(); updateHUD(); draw(); return; } } }

      // auto‑pulo no DEMO
      if(demo){ let nearest=null, nx=Infinity; for(const o of obstacles){ const dx=o.x-(player.x+player.w); if(dx>0&&dx<nx){ nx=dx; nearest=o; } } if(nearest){ const trigger=moveSpeed*0.42; if(nx<trigger && jumpsUsed<MAX_JUMPS){ player.vy=-11.6; player.onGround=false; jumpsUsed++; } } }

      updateHUD(); draw(); requestAnimationFrame(loop);
    }

    function draw(){
      const w=canvas.width/(window.devicePixelRatio||1), h=canvas.height/(window.devicePixelRatio||1); ctx.clearRect(0,0,w,h);
      const t=performance.now()/1000; ctx.save(); for(let i=0;i<3;i++){ const y=h*0.3+i*22; ctx.globalAlpha=0.08+i*0.06; ctx.fillStyle=i%2?'#a78bfa':'#f59e0b'; const offset=(t*30*(i+1)*speed)%(w+120); for(let x=-offset;x<w+120;x+=120){ ctx.fillRect(x,y,90,2);} } ctx.restore();
      ctx.fillStyle='#0a0a16'; ctx.fillRect(0, GROUND_Y(), w, h-GROUND_Y()); ctx.strokeStyle='#322a66'; ctx.lineWidth=2; ctx.beginPath(); ctx.moveTo(0,GROUND_Y()); ctx.lineTo(w,GROUND_Y()); ctx.stroke();

      // Player (usa frames da Malvadinha)
      const drawW=player.w, drawH=player.h; let img=null; if(hitCooldown>0 && hitImg){ img=hitImg; } else if(!player.onGround && jumpImg){ img=jumpImg; } else if(runFrames.length){ img=runFrames[player.frame%runFrames.length]; }
      if(img){ const ratio=img.width/img.height; const destH=drawH; const destW=Math.min(drawW*1.2, destH*ratio); const destX=player.x; const destY=player.y + drawH - destH; ctx.drawImage(img, destX, destY, destW, destH); }
      else { ctx.fillStyle='#a78bfa'; roundRect(ctx, player.x, player.y, player.w, player.h, 8); }

      for(const o of obstacles){ let color='#10b981'; if(o.kind==='tall') color='#f59e0b'; if(o.kind==='fly') color='#e879f9'; ctx.fillStyle=color; roundRect(ctx,o.x,o.y,o.w,o.h,6); ctx.globalAlpha=.25; ctx.fillRect(o.x+4,o.y+4,o.w-8,3); ctx.globalAlpha=1; }

      // HUD do inventário (cosméticos)
      const invX=10, invY=h-28; ctx.font='12px system-ui'; ctx.textBaseline='middle'; let ix=invX;
      if(inventory.garrafa){ ctx.fillStyle='#8b5cf6'; roundRect(ctx, ix, invY, 18, 18, 4); ctx.fillStyle:'#0e0a1f'; ctx.fillText('Cerveja', ix+4, invY+10); ix+=24; }
      if(inventory.latinhas>0){ ctx.fillStyle='#34d399'; roundRect(ctx, ix, invY, 18, 18, 4); ctx.fillStyle:'#0e0a1f'; ctx.fillText('Refri'+inventory.latinhas, ix+22, invY+10); ix+=64; }
      if(inventory.docinhos>0){ ctx.fillStyle='#f472b6'; roundRect(ctx, ix, invY, 18, 18, 4); ctx.fillStyle:'#0e0a1f'; ctx.fillText('Doces'+inventory.docinhos, ix+22, invY+10); }
    }

    function roundRect(ctx,x,y,w,h,r){ r=Math.min(r,w/2,h/2); ctx.beginPath(); ctx.moveTo(x+r,y); ctx.arcTo(x+w,y,x+w,y+h,r); ctx.arcTo(x+w,y+h,x,y+h,r); ctx.arcTo(x,y+h,x,y,r); ctx.arcTo(x,y,x+w,y,r); ctx.fill(); }

    // Carregar imagens e iniciar
    Promise.all([ ...FRAME_PATHS.map(loadImage), loadImage(JUMP_FRAME).catch(()=>null), loadImage(HIT_FRAME).catch(()=>null) ])
      .then(([...frames, jImg, hImg])=>{ runFrames=frames; jumpImg=jImg; hitImg=hImg; })
      .catch(()=>{ /* fallback mantém blocos */ })
      .finally(()=>{ reset(); });

  })();
  </script>
</body>
</html>
